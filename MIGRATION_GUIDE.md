# üîß –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Å—Ç—Ä—É–∫—Ç—É—Ä—ã ID

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞
–í –ø—Ä–æ–µ–∫—Ç–µ FlowBot –±—ã–ª–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –¥–≤—É—Ö —Å–∏—Å—Ç–µ–º ID:
- `id` (SERIAL/UUID) - –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ID
- `telegram_id` (BIGINT) - ID –æ—Ç Telegram

–≠—Ç–æ —Å–æ–∑–¥–∞–≤–∞–ª–æ –ø—É—Ç–∞–Ω–∏—Ü—É –∏ –æ—à–∏–±–∫–∏ —Ç–∏–ø–∞:
```
ERROR: foreign key constraint cannot be implemented
DETAIL: Key columns "achievement_id" and "id" are of incompatible types
```

## ‚úÖ –†–µ—à–µ–Ω–∏–µ
–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –µ–¥–∏–Ω—É—é —Å–∏—Å—Ç–µ–º—É ID, –≥–¥–µ `telegram_id` —è–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–º –∫–ª—é—á–æ–º –≤–µ–∑–¥–µ.

## üöÄ –í–∞—Ä–∏–∞–Ω—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
npm install
npm run migrate:id-fix
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–æ–π (–µ—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

1. **–û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard**
2. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ SQL Editor**
3. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Ñ–∞–π–ª:** `database/migrations/MANUAL_ID_FIX.sql`
4. **–°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –ø–æ—à–∞–≥–æ–≤–æ**

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ë–î

–ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Å–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∑–∞–Ω–æ–≤–æ:

```sql
-- –í Supabase SQL Editor –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–æ –ø–æ—Ä—è–¥–∫—É:
-- 1. database/migrations/001_initial_schema.sql
-- 2. database/migrations/002_seed_achievements.sql  
-- 3. database/migrations/003_referral_system.sql
-- 4. database/migrations/005_fix_id_final.sql
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```sql
-- –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å telegram_id –∫–∞–∫ PRIMARY KEY
SELECT 
    table_name, 
    column_name, 
    data_type, 
    is_nullable
FROM information_schema.columns 
WHERE table_name = 'users' 
    AND column_name IN ('id', 'telegram_id')
ORDER BY table_name, column_name;
```

–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å:
- `users.telegram_id` –∫–∞–∫ `bigint NOT NULL`
- –ù–ï–¢ –ø–æ–ª—è `users.id`

## üìã –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### –î–û –º–∏–≥—Ä–∞—Ü–∏–∏:
```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,        -- ‚ùå –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ID
    telegram_id BIGINT UNIQUE     -- ‚ùå –û—Ç–¥–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ
);

CREATE TABLE tasks (
    user_id INTEGER REFERENCES users(id)  -- ‚ùå –°–≤—è–∑—å —á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ID
);
```

### –ü–û–°–õ–ï –º–∏–≥—Ä–∞—Ü–∏–∏:
```sql
CREATE TABLE users (
    telegram_id BIGINT PRIMARY KEY        -- ‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª—é—á
);

CREATE TABLE tasks (
    telegram_id BIGINT REFERENCES users(telegram_id)  -- ‚úÖ –ü—Ä—è–º–∞—è —Å–≤—è–∑—å
);
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

1. **–£–±—Ä–∞–Ω–∞ –ø—É—Ç–∞–Ω–∏—Ü–∞** –º–µ–∂–¥—É id –∏ telegram_id
2. **–£–ø—Ä–æ—â–µ–Ω –∫–æ–¥** - –≤–µ–∑–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–¥–∏–Ω ID  
3. **–£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –æ—à–∏–±–∫–∏ —Ç–∏–ø–æ–≤** –¥–∞–Ω–Ω—ã—Ö
4. **–ü–æ–≤—ã—à–µ–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –º–µ–Ω—å—à–µ JOIN'–æ–≤
5. **–õ–æ–≥–∏—á–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - Telegram ID –∫–∞–∫ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–ª—é—á

## üö® –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

- ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚úÖ –°—Ç–∞—Ä—ã–µ —Ç–∞–±–ª–∏—Ü—ã —É–¥–∞–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–µ—Ä–µ–Ω–æ—Å–∞
- ‚úÖ –ö–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- ‚ö†Ô∏è –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ–æ–±—Ä–∞—Ç–∏–º–∞—è - —Å–¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º

## üõ†Ô∏è Troubleshooting

### –û—à–∏–±–∫–∞: "table does not exist"
```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –±–∞–∑–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–Ω–∞—á–∞–ª–∞:
# –í Supabase SQL Editor:
# 1. database/migrations/001_initial_schema.sql
# 2. database/migrations/002_seed_achievements.sql
```

### –û—à–∏–±–∫–∞: "incompatible types"  
```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä—É—á–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é:
# database/migrations/MANUAL_ID_FIX.sql
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∏–ø achievements.id –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º
```

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª:
SUPABASE_URL=your_url
SUPABASE_SERVICE_KEY=your_service_key
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –º–∏–≥—Ä–∞—Ü–∏–µ–π:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
2. –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –æ—à–∏–±–∫–∏  
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä—É—á–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é
4. –í –∫—Ä–∞–π–Ω–µ–º —Å–ª—É—á–∞–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –ë–î –∑–∞–Ω–æ–≤–æ